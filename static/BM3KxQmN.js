import{S as O,t as i,b1 as w,cl as H,j as P,k as v,m as S,d as M,g as T,cm as N,cn as A,co as R,bu as j,cp as W,bt as D}from"./BBnRYWwF.js";import{a as X}from"./CMV_8iDO.js";function Y(r,a){const f=a.textSizePx*1.5,h=(r==null?[]:Array.isArray(r)?r:typeof r=="string"?r.split(`
`):[r]).filter(c=>c!="").map((c,o)=>`<tspan x="0" y="${o*f}">${c}</tspan>`).join("");return h?`<text font-size="${a.textSize}" fill="${a.textColor}" x="0" y="0" style="dominant-baseline:text-before-edge">
    ${h}
  </text>`:""}function G({rootSelection:r,pluginName:a,gClassName:f,boxClassName:y,rootWidth:h,rootHeight:c,svgString:o,tooltipStyle:s,event:p}){r.interrupt("fadeout");const x=5,g=o?[o]:[],$=o?[s]:[],n=r.selectAll(`g.${f}`).data(g).join(e=>e.append("g").classed(f,!0).attr("pointer-events","none"),e=>e,e=>e.style("opacity",0).remove()).attr("transform",()=>`translate(${p.offsetX}, ${p.offsetY})`).selectAll(`g.${y}`).data($).join(e=>e.append("g").classed(T(a,"box"),!0)),z=n.selectAll("rect").data($).join(e=>e.append("rect").attr("rx",x).attr("ry",x)).attr("fill",e=>e.backgroundColor).attr("stroke",e=>e.strokeColor).attr("opacity",e=>e.backgroundOpacity),m=n.selectAll("g").data(g).join(e=>e.append("g").classed(T(a,"content"),!0).attr("transform",()=>`translate(${s.padding}, ${s.padding})`));g.length&&N(m,g[0]);const C=m!=null&&m.node()?A(m):{width:0,height:0};z.attr("width",C.width+s.padding*2).attr("height",C.height+s.padding*2);const b=n!=null&&n.node()?A(n):{width:0,height:0},t=h-b.width,u=c-b.height,l=p.offsetX+s.offset[0]>t?t-p.offsetX:s.offset[0],d=p.offsetY+s.offset[1]>u?u-p.offsetY:s.offset[1];n.attr("transform",e=>`translate(${l}, ${d})`),n.attr("transform",e=>`translate(${l}, ${d})`)}function U(r){R(`g.${r}`).remove()}const q=(r,{rootSelection:a,fullParams$:f,fullChartParams$:y,layout$:h,event$:c})=>{const o=new O,s=T(r,"g"),p=T(r,"box"),x=c.pipe(i(o),w(t=>t.eventName==="mouseover"||t.eventName==="mousemove")),g=c.pipe(i(o),w(t=>t.eventName==="mouseout")),$=H(y),k=P({fullChartParams:y,fullParams:f,textSizePx:$}).pipe(i(o),v(async t=>t),S(t=>({backgroundColor:j(t.fullParams.backgroundColorType,t.fullChartParams),backgroundOpacity:t.fullParams.backgroundOpacity,strokeColor:j(t.fullParams.strokeColorType,t.fullChartParams),offset:t.fullParams.offset,padding:t.fullParams.padding,textSize:t.fullChartParams.styles.textSize,textSizePx:t.textSizePx,textColor:j(t.fullParams.textColorType,t.fullChartParams),seriesColors:t.fullChartParams.colors[t.fullChartParams.colorScheme].label}))),n=P({fullParams:f,tooltipStyle:k}).pipe(i(o),v(async t=>t),S(t=>u=>{const l=t.fullParams.renderFn(u,{utils:{toCurrency:W,measureTextWidth:D},styles:t.tooltipStyle});if(typeof l=="string"){const d=l.trim();if(d.slice(0,1)==="<"&&d.slice(d.length-1,d.length)===">")return l;{const F=l.split(`
`);return Y(F,t.tooltipStyle)}}else if(Array.isArray(l))return Y(l,t.tooltipStyle);return""})),z=P({event:x,contentRenderFn:n}).pipe(i(o),v(async t=>t),S(t=>t.contentRenderFn(t.event))),m=g.pipe(i(o),S(t=>"")),C=X(z,m).pipe(i(o),M((t,u)=>t===u)),b=X(x,g).pipe(i(o));return P({svgString:C,layout:h,tooltipStyle:k}).pipe(i(o),v(async t=>t),v(t=>b.pipe(S(u=>({svgString:t.svgString,layout:t.layout,tooltipStyle:t.tooltipStyle,eventTooltip:u}))))).subscribe(t=>{if(t.eventTooltip.eventName==="mouseout"){U(s);return}G({rootSelection:a,pluginName:r,gClassName:s,boxClassName:p,rootWidth:t.layout.rootWidth,rootHeight:t.layout.rootHeight,svgString:t.svgString,tooltipStyle:t.tooltipStyle,event:t.eventTooltip.event})}),()=>{o.next(void 0)}};export{q as c};
