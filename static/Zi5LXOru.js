import{az as R,aF as V,bj as j,aD as z,aK as $,aN as C,aI as O,aJ as F,bk as U,aR as J,aH as b,aT as Y,aO as G,aU as X,bl as K,j as P,k as S,d as y,m as f,a as M,g as N,bm as Q,aY as H,S as w,t as g,s as W,a3 as Z,L as ee,aq as D,q as te,b4 as ae,be as k,ac as re,aW as se}from"./BBnRYWwF.js";import{c as ie}from"./CcijejhK.js";const ne=s=>{const e=R(s,{visibleFilter:{toBeTypes:["Function"]},sort:{toBeTypes:["Function","null"]},seriesLabels:{toBeTypes:["string[]"]},container:{toBeTypes:["object"]},separateSeries:{toBeTypes:["boolean"]},sumSeries:{toBeTypes:["boolean"]}});if(s.container){const a=R(s.container,{columnAmount:{toBeTypes:["number"]},rowAmount:{toBeTypes:["number"]},columnGap:{toBe:'"auto" | number',test:u=>u==="auto"||typeof u=="number"},rowGap:{toBe:'"auto" | number',test:u=>u==="auto"||typeof u=="number"}});if(a.status==="error")return a}return e},le=s=>{const{data:e=[],dataFormatter:a,chartParams:u}=s;if(!e.length)return[];let l=[];try{const t=(i,n,c,m)=>{const h=V(a.type,n,c),d=a.seriesLabels[n]||j("series",n),o=z(n,u);return typeof i=="number"?{id:h,index:m,seq:0,label:h,description:"",data:{},value:i,seriesIndex:n,seriesLabel:d,color:o,visible:!0}:{id:i.id?i.id:h,index:m,seq:0,label:i.label?i.label:h,description:i.description,data:i.data??{},value:i.value,seriesIndex:n,seriesLabel:d,color:o,visible:!0}};l=e.map((i,n)=>Array.isArray(i)?i.map((c,m)=>t(c,n,m,l.length+m)):t(i,n,0,l.length)).flat().sort(a.sort??void 0).map((i,n)=>(i.seq=n,i)).map(i=>(i.visible=a.visibleFilter(i,s),i)).sort((i,n)=>i.index-n.index).reduce((i,n)=>(i[n.seriesIndex]||(i[n.seriesIndex]=[]),i[n.seriesIndex].push(n),i),[])}catch(t){throw Error(t)}return l},oe=s=>R({data:s},{data:{toBe:"(DataSeriesDatum | DataSeriesValue)[][] | (DataSeriesDatum | DataSeriesValue)[]",test:a=>Array.isArray(a)}}),ue=({computedData$:s})=>{const e=new Set;return s.pipe($(a=>(a.forEach(u=>{u.forEach(l=>{e.add(l.label)})}),Array.from(e))))},pe=({fullDataFormatter$:s})=>s.pipe($(e=>e.separateSeries),C()),ce=({fullDataFormatter$:s})=>s.pipe($(e=>e.separateLabel),C()),me=({fullDataFormatter$:s})=>s.pipe($(e=>e.sumSeries),C()),he=({computedData$:s})=>s.pipe($(e=>e.filter(a=>a.length).map(a=>a[0].seriesLabel)),C((e,a)=>JSON.stringify(e)===JSON.stringify(a))),de=({computedData$:s})=>s.pipe($(e=>e.map(a=>a.filter(u=>u.visible!=!1)))),ge=({computedData$:s,separateSeries$:e,separateLabel$:a,sumSeries$:u,datumLabels$:l})=>O({computedData:s,separateSeries:e,separateLabel:a,sumSeries:u,datumLabels:l}).pipe(F(async t=>t),$(t=>{const i=t.sumSeries==!0?t.computedData.map(m=>[m.reduce((h,d)=>h==null?d:(h.value=h.value+d.value,h),null)]):t.computedData,n=t.separateSeries==!0?i:[i.flat()],c=t.separateLabel==!0?(()=>{const m=t.datumLabels.reduce((h,d,o)=>(h[d]=o,h),{});return n.map(h=>h.reduce((d,o)=>{const r=m[o.label];return d[r]==null&&(d[r]=[]),d[r].push(o),d},[])).flat()})():n;return t.separateSeries==!0&&t.separateLabel==!0?c.sort((m,h)=>m[0].seq-h[0].seq):c.map(m=>m.sort((h,d)=>h.seq-d.seq))})),be=({computedSortedData$:s,fullDataFormatter$:e,layout$:a})=>O({computedSortedData:s,fullDataFormatter:e,layout:a}).pipe(F(async l=>l),$(l=>{const t=l.computedSortedData.length;return U(l.layout,l.fullDataFormatter.container,t)})),$e=({seriesContainerPosition$:s,computedSortedData$:e})=>O({seriesContainerPosition:s,computedSortedData:e}).pipe(F(async a=>a),$(a=>new Map(a.computedSortedData.map((u,l)=>u.map(t=>[t.id,a.seriesContainerPosition[l]])).flat()))),fe=({subject:s,observer:e})=>{const a=J(e.fullChartParams$).pipe(b(1)),u=ue({computedData$:e.computedData$}).pipe(b(1)),l=pe({fullDataFormatter$:e.fullDataFormatter$}).pipe(b(1)),t=ce({fullDataFormatter$:e.fullDataFormatter$}).pipe(b(1)),i=me({fullDataFormatter$:e.fullDataFormatter$}).pipe(b(1)),n=ge({computedData$:e.computedData$,separateSeries$:l,separateLabel$:t,sumSeries$:i,datumLabels$:u}).pipe(b(1)),c=de({computedData$:n}).pipe(b(1)),m=e.computedData$.pipe($(A=>A.flat())).pipe(b(1)),h=Y({datumList$:m,fullChartParams$:e.fullChartParams$,event$:s.event$}).pipe(b(1)),d=he({computedData$:e.computedData$}).pipe(b(1)),o=G({datumList$:m}).pipe(b(1)),r=be({computedSortedData$:n,fullDataFormatter$:e.fullDataFormatter$,layout$:e.layout$}).pipe(b(1)),p=$e({seriesContainerPosition$:r,computedSortedData$:n}).pipe(b(1));return{fullParams$:e.fullParams$,fullChartParams$:e.fullChartParams$,fullDataFormatter$:e.fullDataFormatter$,computedData$:e.computedData$,layout$:e.layout$,textSizePx$:a,visibleComputedSortedData$:c,separateSeries$:l,separateLabel$:t,sumSeries$:i,computedSortedData$:n,seriesHighlight$:h,seriesLabels$:d,SeriesDataMap$:o,seriesContainerPosition$:r,DatumContainerPositionMap$:p}};class Be extends X{constructor(e,a){super({defaultDataFormatter:K,dataFormatterValidator:ne,computedDataFn:le,dataValidator:oe,contextObserverCallback:fe},e,a)}}function Pe({selection:s,pluginName:e,visibleComputedSortedData$:a}){const u=N(e,"series");return a.pipe(f(l=>l.map(t=>t[0]?`${t[0].seriesLabel}_${t[0].label}`:"")),y((l,t)=>JSON.stringify(l)===JSON.stringify(t)),f(l=>s.selectAll(`g.${u}`).data(l,t=>t).join(t=>t.append("g").classed(u,!0),t=>t,t=>t.remove())),M(1))}const Se=({selection:s,pluginName:e,visibleComputedSortedData$:a,seriesContainerPosition$:u})=>{const l=Pe({selection:s,pluginName:e,visibleComputedSortedData$:a});return P({seriesCenterSelection:l,seriesContainerPosition:u}).pipe(S(async t=>t),y((t,i)=>t.seriesContainerPosition.length===i.seriesContainerPosition.length)).subscribe(t=>{t.seriesCenterSelection.attr("transform",(i,n)=>{const c=t.seriesContainerPosition[n]??t.seriesContainerPosition[0];return`translate(${c.centerX}, ${c.centerY})`})}),P({seriesCenterSelection:l,seriesContainerPosition:u}).pipe(S(async t=>t)).subscribe(t=>{t.seriesCenterSelection.transition().attr("transform",(i,n)=>{const c=t.seriesContainerPosition[n]??t.seriesContainerPosition[0];return`translate(${c.centerX}, ${c.centerY})`})}),{seriesCenterSelection$:l}};function De({data:s,startAngle:e,endAngle:a}){return Q().startAngle(e).endAngle(a).value(t=>t.value).sort((t,i)=>t.seq-i.seq)(s).map((t,i)=>{let n=t;return n.id=t.data.id,n})}const v="Pie",ye={name:v,defaultParams:Z,layerIndex:ee,validator:(s,{validateColumns:e})=>e(s,{outerRadius:{toBeTypes:["number"]},innerRadius:{toBeTypes:["number"]},outerRadiusWhileHighlight:{toBeTypes:["number"]},startAngle:{toBeTypes:["number"]},endAngle:{toBeTypes:["number"]},padAngle:{toBeTypes:["number"]},strokeColorType:{toBeTypes:["string"]},strokeWidth:{toBeTypes:["number"]},cornerRadius:{toBeTypes:["number"]}})};function Ce({enter:s,exit:e,data:a,lastTweenData:u,fullParams:l}){return!s.size()&&!e.size()?t=>{const i=a.map((n,c)=>{const m=u[c]??{startAngle:0,endAngle:0,value:0};return{...n,startAngle:n.startAngle*t+m.startAngle*(1-t),endAngle:n.endAngle*t+m.endAngle*(1-t),value:n.value*t+m.value*(1-t)}});return B(i,l.startAngle,l.endAngle,1)}:t=>B(a,l.startAngle,l.endAngle,t)}function B(s,e,a,u){return s.map((l,t)=>{const i=e+(l.startAngle-e)*u,n=i+(l.endAngle-l.startAngle)*u;return{...l,startAngle:i,endAngle:n}})}function E({selection:s,data:e,arc:a,pathClassName:u,fullParams:l,fullChartParams:t}){return s.selectAll("path").data(e,n=>n.id).join("path").classed(u,!0).style("cursor","pointer").attr("fill",(n,c)=>n.data.color).attr("stroke",(n,c)=>te({datum:n.data,colorType:l.strokeColorType,fullChartParams:t})).attr("stroke-width",l.strokeWidth).attr("d",(n,c)=>a(n))}function Ae({pathSelection:s,ids:e,fullChartParams:a,arc:u,arcHighlight:l}){if(s.interrupt("highlight"),!e.length){s.transition("highlight").style("opacity",1).attr("d",t=>u(t));return}s.each((t,i,n)=>{const c=W(n[i]);e.includes(t.data.id)?c.style("opacity",1).transition("highlight").ease(ae).duration(500).attr("d",m=>l(m)):c.style("opacity",a.styles.unhighlightedOpacity).transition("highlight").attr("d",m=>u(m))})}function Te(s,e){const a=new w,u=N(s,"path");let l=[],t=[];const i=e.seriesContainerPosition$.pipe(g(a),f(o=>o.width<o.height?o.width:o.height),y()),n=new D(o=>{P({containerVisibleComputedSortedData:e.containerVisibleComputedSortedData$,fullParams:e.fullParams$}).pipe(g(a),S(async r=>r)).subscribe(r=>{const p=De({data:r.containerVisibleComputedSortedData,startAngle:r.fullParams.startAngle,endAngle:r.fullParams.endAngle});o.next(p)})}),c=new D(o=>{P({shorterSideWith:i,fullParams:e.fullParams$}).pipe(g(a),S(async r=>r)).subscribe(r=>{const p=k({axisWidth:r.shorterSideWith,innerRadius:r.fullParams.innerRadius,outerRadius:r.fullParams.outerRadius,padAngle:r.fullParams.padAngle,cornerRadius:r.fullParams.cornerRadius});o.next(p)})}),m=new D(o=>{P({shorterSideWith:i,fullParams:e.fullParams$}).pipe(g(a),S(async r=>r)).subscribe(r=>{const p=k({axisWidth:r.shorterSideWith,innerRadius:r.fullParams.innerRadius,outerRadius:r.fullParams.outerRadiusWhileHighlight,padAngle:r.fullParams.padAngle,cornerRadius:r.fullParams.cornerRadius});o.next(p)})}),h=e.fullChartParams$.pipe(g(a),f(o=>o.highlightTarget),y());e.seriesHighlight$.pipe(g(a)).subscribe(o=>o);const d=new D(o=>{P({pieData:n,arc:c,computedData:e.computedData$,fullParams:e.fullParams$,fullChartParams:e.fullChartParams$,highlightTarget:h}).pipe(g(a),S(async r=>r)).subscribe(r=>{e.containerSelection.interrupt("graphicMove");const p=e.containerSelection.selectAll("path").data(r.pieData,T=>T.id),A=p.enter(),I=p.exit(),x=Ce({enter:A,exit:I,data:r.pieData,lastTweenData:l,fullParams:r.fullParams});e.containerSelection.transition("graphicMove").duration(r.fullChartParams.transitionDuration).tween("move",(T,q)=>L=>{t=x(L),E({selection:e.containerSelection,data:t,arc:r.arc,pathClassName:u,fullParams:r.fullParams,fullChartParams:r.fullChartParams})}).on("end",(T,q)=>{t=B(r.pieData,r.fullParams.startAngle,r.fullParams.endAngle,1);const L=E({selection:e.containerSelection,data:t,arc:r.arc,pathClassName:u,fullParams:r.fullParams,fullChartParams:r.fullChartParams});o.next(L),l=Object.assign([],r.pieData),e.event$.next({type:"series",pluginName:s,eventName:"transitionEnd",event:void 0,highlightTarget:r.highlightTarget,data:r.computedData,series:[],seriesIndex:-1,seriesLabel:"",datum:null})})})}).pipe(M(1));return P({pathSelection:d,SeriesDataMap:e.SeriesDataMap$,computedData:e.computedData$,highlightTarget:h}).pipe(g(a),S(async o=>o)).subscribe(o=>{o.pathSelection.on("mouseover",(r,p)=>{r.stopPropagation(),e.event$.next({type:"series",eventName:"mouseover",pluginName:s,highlightTarget:o.highlightTarget,datum:p.data,series:o.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:r,data:o.computedData})}).on("mousemove",(r,p)=>{r.stopPropagation(),e.event$.next({type:"series",eventName:"mousemove",pluginName:s,highlightTarget:o.highlightTarget,datum:p.data,series:o.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:r,data:o.computedData})}).on("mouseout",(r,p)=>{r.stopPropagation(),e.event$.next({type:"series",eventName:"mouseout",pluginName:s,highlightTarget:o.highlightTarget,datum:p.data,series:o.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:r,data:o.computedData})}).on("click",(r,p)=>{r.stopPropagation(),e.event$.next({type:"series",eventName:"click",pluginName:s,highlightTarget:o.highlightTarget,datum:p.data,series:o.SeriesDataMap.get(p.data.seriesLabel),seriesIndex:p.data.seriesIndex,seriesLabel:p.data.seriesLabel,event:r,data:o.computedData})})}),P({pathSelection:d,highlight:e.seriesHighlight$.pipe(f(o=>o.map(r=>r.id))),fullChartParams:e.fullChartParams$,arc:c,arcHighlight:m}).pipe(g(a),S(async o=>o)).subscribe(o=>{Ae({pathSelection:o.pathSelection,ids:o.highlight,fullChartParams:o.fullChartParams,arc:o.arc,arcHighlight:o.arcHighlight})}),()=>{a.next(void 0)}}const Oe=H(ye)(({selection:s,name:e,subject:a,observer:u})=>{const l=new w,{seriesCenterSelection$:t}=Se({selection:s,pluginName:v,visibleComputedSortedData$:u.visibleComputedSortedData$,seriesContainerPosition$:u.seriesContainerPosition$}),i=[];return t.pipe(g(l)).subscribe(n=>{i.forEach(c=>c()),n.each((c,m,h)=>{const d=W(h[m]),o=u.visibleComputedSortedData$.pipe(g(l),f(p=>p[m]??p[0])),r=u.seriesContainerPosition$.pipe(g(l),f(p=>p[m]??p[0]));i[m]=Te(v,{containerSelection:d,computedData$:u.computedData$,containerVisibleComputedSortedData$:o,SeriesDataMap$:u.SeriesDataMap$,fullParams$:u.fullParams$,fullChartParams$:u.fullChartParams$,seriesHighlight$:u.seriesHighlight$,seriesContainerPosition$:r,event$:a.event$})})}),()=>{l.next(void 0),i.forEach(n=>n())}}),_="SeriesLegend",Le={name:_,defaultParams:re,layerIndex:se,validator:(s,{validateColumns:e})=>e(s,{placement:{toBe:'"top" | "top-start" | "top-end" | "bottom" | "bottom-start" | "bottom-end" | "left" | "left-start" | "left-end" | "right" | "right-start" | "right-end"',test:u=>["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"].includes(u)},padding:{toBeTypes:["number"]},backgroundFill:{toBeOption:"ColorType"},backgroundStroke:{toBeOption:"ColorType"},gap:{toBeTypes:["number"]},listRectWidth:{toBeTypes:["number"]},listRectHeight:{toBeTypes:["number"]},listRectRadius:{toBeTypes:["number"]},textColorType:{toBeOption:"ColorType"}})},Fe=H(Le)(({selection:s,rootSelection:e,observer:a,subject:u})=>{const l=new w,t=a.SeriesDataMap$.pipe(g(l),f(c=>Array.from(c.keys()))),i=a.fullParams$.pipe(g(l),f(c=>{const m=[{listRectWidth:c.listRectWidth,listRectHeight:c.listRectHeight,listRectRadius:c.listRectRadius}];return{...c,labelList:m}})),n=ie(_,{rootSelection:e,legendLabels$:t,fullParams$:i,layout$:a.layout$,fullChartParams$:a.fullChartParams$,textSizePx$:a.textSizePx$});return()=>{l.next(void 0),n()}});export{Oe as P,Fe as S,Be as a,De as m,Se as s};
