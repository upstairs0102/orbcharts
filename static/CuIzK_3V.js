import{aY as D,S as x,t as m,s as S,m as d,a1 as T,b0 as C,d as E,j as A,k as v,g as F}from"./BBnRYWwF.js";import{s as L}from"./Zi5LXOru.js";const g="PieEventTexts",P=F(g,"text"),N={name:g,defaultParams:T,layerIndex:C,validator:(l,{validateColumns:r})=>r(l,{renderFn:{toBeTypes:["Function"]},textAttrs:{toBeTypes:["object[]"]},textStyles:{toBeTypes:["object[]"]}})};function f(l,r){const s=l.selectAll(`text.${P}`).data(r),o=s.enter().append("text").classed(P,!0),n=s.merge(o);return n.each((t,e,i)=>{const u=S(i[e]).text(t.text);Object.keys(t.attr).forEach(a=>{u.attr(a,t.attr[a])}),Object.keys(t.style).forEach(a=>{u.style(a,t.style[a])})}),s.exit().remove(),n}function $({eventData:l,renderFn:r,textAttrs:s,textStyles:o}){const n=r(l);return n===null?null:(Array.isArray(n)?n:[n]).map((e,i)=>({text:e,attr:s[i],style:o[i]}))}function _(l,r){const s=new x;let o;const n=r.fullChartParams$.pipe(m(s),d(e=>e.highlightTarget),E());let t=[];return r.seriesHighlight$.pipe(m(s)).subscribe(e=>t=e),A({computedData:r.computedData$,fullParams:r.fullParams$,fullChartParams:r.fullChartParams$,highlightTarget:n}).pipe(m(s),v(async e=>e)).subscribe(e=>{r.containerSelection.transition("move").duration(e.fullChartParams.transitionDuration).tween("move",(i,u)=>a=>{const c=$({eventData:{type:"series",pluginName:l,eventName:"transitionMove",event:i,tween:a,highlightTarget:e.highlightTarget,data:e.computedData,series:t,seriesIndex:t[0]?t[0].seriesIndex:-1,seriesLabel:t[0]?t[0].seriesLabel:"",datum:t[0]||null},renderFn:e.fullParams.renderFn,textAttrs:e.fullParams.textAttrs,textStyles:e.fullParams.textStyles});c!=null&&f(r.containerSelection,c)}).on("end",(i,u)=>{const a=$({eventData:{type:"series",pluginName:l,eventName:"transitionEnd",event:i,tween:1,highlightTarget:e.highlightTarget,data:e.computedData,series:t,seriesIndex:t[0]?t[0].seriesIndex:-1,seriesLabel:t[0]?t[0].seriesLabel:"",datum:t[0]||null},renderFn:e.fullParams.renderFn,textAttrs:e.fullParams.textAttrs,textStyles:e.fullParams.textStyles});a!=null&&f(r.containerSelection,a),o&&o.unsubscribe(),o=r.event$.subscribe(c=>{const p=$({eventData:c,renderFn:e.fullParams.renderFn,textAttrs:e.fullParams.textAttrs,textStyles:e.fullParams.textStyles});p!=null&&f(r.containerSelection,p)})})}),()=>{s.next(void 0)}}const M=D(N)(({selection:l,name:r,observer:s,subject:o})=>{const n=new x,{seriesCenterSelection$:t}=L({selection:l,pluginName:g,visibleComputedSortedData$:s.visibleComputedSortedData$,seriesContainerPosition$:s.seriesContainerPosition$}),e=[];return t.pipe(m(n)).subscribe(i=>{e.forEach(u=>u()),i.each((u,a,c)=>{const p=S(c[a]),y=s.computedSortedData$.pipe(m(n),d(h=>h[a]??h[0])),b=s.seriesContainerPosition$.pipe(m(n),d(h=>h[a]??h[0]));e[a]=_(g,{containerSelection:p,computedData$:s.computedData$,containerComputedSortedData$:y,SeriesDataMap$:s.SeriesDataMap$,fullParams$:s.fullParams$,fullChartParams$:s.fullChartParams$,seriesHighlight$:s.seriesHighlight$,seriesContainerPosition$:b,event$:o.event$})})}),()=>{n.next(void 0),e.forEach(i=>i())}});export{M as P};
